<!DOCTYPE html>
<html>
<head>
    <title>Skill Matching with Levels</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container d-flex flex-column justify-content-center align-items-center vh-100">
        <div id="output"></div>
    </div>

    <script>
        async function fetchSkills() {
            try {
                const res = await fetch('http://localhost:5001/skills'); // TO DO: replace with flask API URL
                const data = await res.json();
                
                if (data.code === 200) { 
                  return data.data.skill; // rn im assuming skills are in this format
                } else {
                    console.error('Failed to fetch skills.');
                }
            } catch (err) {
                console.error('An error occurred:', err);
            }
        }

        async function fetchLackingSkills(staffId, roleId) {
            try {
                const res = await fetch(`http://localhost:5001/get-lacking-skills/${staffId}/${roleId}`);
                const data = await res.json();

                if (data.code === 200) {
                    return data.lacking_skills;
                } else {
                    console.error('Failed to fetch lacking skills.');
                }
            } catch (err) {
                console.error('An error occurred:', err);
            }
        }

        function matchSkills(staffSkills, jobSkills) {
            let output = '<h1 class="text-center mb-5">Skill Matching</h1>';
            

            // loop through jobSkills to calculate matching, lacking and percentage
            output += '<h2 class="mb-3">Your Skills:</h2>';
            output += '<ul class="list-group mb-4">';
            staffSkills.forEach(skillObj => {
                output += `<li class="list-group-item">${skillObj.skill} - ${skillObj.level}</li>`;
            });
            output += '</ul>';
            
            output += '<h2 class="mb-3">Job Requirements:</h2>';
            output += '<ul class="list-group mb-4">';
            
            jobSkills.forEach(jobSkillObj => {
                const match = staffSkills.find(staffSkillObj => staffSkillObj.skill === jobSkillObj.skill && staffSkillObj.level === jobSkillObj.level);
                if (match) {
                    output += `<li class="list-group-item list-group-item-success">${jobSkillObj.skill} - ${jobSkillObj.level} (Perfect Match)</li>`;
                } else {
                    const partialMatch = staffSkills.find(staffSkillObj => staffSkillObj.skill === jobSkillObj.skill);
                    if (partialMatch) {
                        output += `<li class="list-group-item list-group-item-warning">${jobSkillObj.skill} - ${jobSkillObj.level} (Your Level: ${partialMatch.level})</li>`;
                    } else {
                        output += `<li class="list-group-item list-group-item-danger">${jobSkillObj.skill} - ${jobSkillObj.level} (Not Matched)</li>`;
                    }
                }
            });

            output += '</ul>';

            // logic for showing resources to improve skills
            output += '<h2 class="mb-3">Resources to Improve:</h2>';
            output += '<ul class="list-group mb-4">';
            // placeholders rn 
            output += '<li class="list-group-item">Tutorial for Python</li>';
            output += '<li class="list-group-item">Course for Communication Skills</li>';
            output += '</ul>';

            return output;
        }

        // fetch data and display
        Promise.all([fetchSkills(), fetchLackingSkills(123456789, 123456)]) // TODO: replace these IDs with real values
        .then(([staffSkills, lackingSkills]) => {
            // TODO: REPLACE staffSkills and jobSkills with fetched data
            // hardcoded for NOW
            const jobSkills = [
                { skill: 'JavaScript', level: 'Intermediate' },
                { skill: 'HTML', level: 'Intermediate' },   
                { skill: 'CSS', level: 'Expert' },
                { skill: 'Python', level: 'Beginner' },
                { skill: 'Communication', level: 'Intermediate' }
            ];
            
            const output = matchSkills(staffSkills, jobSkills);
            document.getElementById('output').innerHTML = output;
        });
    </script>
</body>
</html>
